<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="一个网上看到的讨论，解释的非常好，收藏一下。 问题： &gt;&gt;&gt; [i for i in itertools.repeat(&#39;example&#39;, 5)] [&#39;example&#39;, &#39;example&#39;, &#39;example&#39;, &#39;example&#39;, &#39;example&#39;] &gt;&gt;&gt; [&#39;example&#39;] * 5 [&#39;example&#39;, &#39;example&#39;, &#39;example&#39;, &#39;example&#39;,...">
        <meta name="keywords" content="">
        <link rel="icon" href="./images/favicon.ico">
        <!-- Canonical -->
        <link rel="canonical" href="./itertoolsrepeat.html">
        <!-- /Canonical -->

        <title>itertools.repeat - Alfalfa</title>

        <!-- Stylesheets -->
        <link href="./theme/css/all.min.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->



    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="./"><img class="mr20" src="./images/log.png" alt="logo">Alfalfa</a>
                    </div>
                    <div class="nav pull-right">
                                <a href="./">Homepage</a>
                                <a href="./categories.html">Categories</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">itertools.repeat</h1>
                      <p class="header-date">By <a href="./author/alfalfa.html">Alfalfa</a>, Thu 12 May 2022, modified Thu 12 May 2022, in category <a href="./category/python.html">Python</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>一个网上看到的讨论，解释的非常好，收藏一下。</p>
<h2>问题：</h2>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)]</span><span class="w"></span>
<span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="w"></span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;example&#39;</span><span class="p">]</span><span class="w"></span>

<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span><span class="w"> </span><span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)))</span><span class="w"></span>
<span class="p">[</span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">]</span><span class="w"></span>
<span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;example&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="p">[</span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;EXAMPLE&#39;</span><span class="p">]</span><span class="w"></span>
</code></pre></div>

<p>大意是不使用 itertools.repeat() 也可以得到相类似的结果，那么使用 itertools.repeat() 是必要的吗？itertools.repeat() 实现会更好吗？为什么？</p>
<h2>解答：</h2>
<h3>one</h3>
<p>itertools.repeat的主要目的是提供与map或zip一起使用的恒定值流：</p>
<div class="highlight"><pre><span></span><code>&gt;&gt;&gt; list(map(pow, range(10), repeat(2)))     # list of squares
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
</code></pre></div>

<p>第二个目的是，它提供了一种非常快速的循环方式，循环次数固定如下：</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">itertools</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">None</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">):</span><span class="w"></span>
<span class="w">    </span><span class="n">do_something</span><span class="p">()</span><span class="w"></span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="mi">10000</span><span class="ss">)</span>:
    <span class="nv">do_something</span><span class="ss">()</span>
</code></pre></div>

<p>两者相比，前者更好，因为它只需要更新现有 None 对象的引用计数。后者则需要 range() 制造 10000 个不同的整数对象。</p>
<p>注意，Guido自己在timeit()模块中使用了快速循环技术。请参阅https://hg.python.org/cpython/file/2.7/Lib/timeit.py#l195上的源代码：</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="nl">itertools</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itertools</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="n">number</span><span class="p">)</span><span class="w"></span>
<span class="k">else</span><span class="err">:</span><span class="w"></span>
<span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">None</span><span class="o">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">number</span><span class="w"></span>
<span class="n">gcold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gc</span><span class="p">.</span><span class="n">isenabled</span><span class="p">()</span><span class="w"></span>
<span class="n">gc</span><span class="p">.</span><span class="n">disable</span><span class="p">()</span><span class="w"></span>
<span class="k">try</span><span class="err">:</span><span class="w"></span>
<span class="w">    </span><span class="n">timing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="k">inner</span><span class="p">(</span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">timer</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<h3>two</h3>
<p>itertools.repeat函数是惰性的；它只使用一个项所需的内存。另一方面，(a,) * n和[a] * n习惯用法在内存中创建对象的n个副本。对于五个项目，乘法习惯用法可能更好，但是如果必须重复某些内容（比如说，一百万次），您可能会注意到资源问题。</p>
<p>然而，很难想象许多静态用于itertools.repeat。然而，事实上itertools.repeat是一个函数允许您在许多函数应用程序中使用它。例如，您可能有一些库函数func，它对一个iterable输入进行操作。有时，您可能已经预先构建了各种项的列表。其他时候，你可能只想在统一的名单上做手术。如果列表很大，itertools.repeat将为您节省内存。</p>
<p>最后，repeat使itertools文档中描述的所谓“迭代器代数”成为可能。甚至itertools模块本身也使用repeat函数。例如，下面的代码是作为itertools.izip_longest的等价实现给出的（即使真正的代码可能是用C编写的）。请注意下面使用的repeat七行：</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="n">ZipExhausted</span>(<span class="nb">Exception</span>):
    <span class="nb">pass</span>

<span class="n">def</span> <span class="n">izip_longest</span>(*<span class="nb">args</span>, **<span class="n">kwds</span>):
    <span class="c1"># izip_longest(&#39;ABCD&#39;, &#39;xy&#39;, fillvalue=&#39;-&#39;) --&gt; Ax By C- D-</span>
    <span class="n">fillvalue</span> = <span class="n">kwds</span>.<span class="nb">get</span>(<span class="s">&#39;fillvalue&#39;</span>)
    <span class="n">counter</span> = [<span class="n">len</span>(<span class="nb">args</span>) - <span class="mi">1</span>]
    <span class="n">def</span> <span class="n">sentinel</span>():
        <span class="k">if</span> <span class="nb">not</span> <span class="n">counter</span>[<span class="mi">0</span>]:
            <span class="n">raise</span> <span class="n">ZipExhausted</span>
        <span class="n">counter</span>[<span class="mi">0</span>] -= <span class="mi">1</span>
        <span class="nb">yield</span> <span class="n">fillvalue</span>
    <span class="n">fillers</span> = <span class="k">repeat</span>(<span class="n">fillvalue</span>)
    <span class="n">iterators</span> = [<span class="n">chain</span>(<span class="n">it</span>, <span class="n">sentinel</span>(), <span class="n">fillers</span>) <span class="k">for</span> <span class="n">it</span> <span class="nb">in</span> <span class="nb">args</span>]
    <span class="n">try:</span>
        <span class="k">while</span> <span class="n">iterators:</span>
            <span class="nb">yield</span> <span class="n">tuple</span>(<span class="n">map</span>(<span class="nb">next</span>, <span class="n">iterators</span>))
    <span class="n">except</span> <span class="n">ZipExhausted:</span>
        <span class="nb">pass</span>
</code></pre></div>

<h3>three</h3>
<p>你的例子foo * 5表面上看起来与itertools.repeat(foo, 5)很相似，但实际上却完全不同。</p>
<p>如果你写foo * 100000，解释器必须创建100000份foo，然后才能给你答案。因此，这是一个非常昂贵且不利于记忆的操作。</p>
<p>但是，如果您编写itertools.repeat(foo, 100000)，解释器可以返回一个为同一个函数服务的迭代器，并且在您需要结果之前不需要计算结果——例如，通过在一个函数中使用它来知道序列中的每个结果。</p>
<p>这是迭代器的主要优点：它们可以将列表的一部分（或全部）的计算推迟到您真正需要答案的时候。</p>
<p><a href="https://www.cnpython.com/qa/60172">Python的itertools.repeat的目的是什么？</a></p>


        
    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="./archives.html">Archives</a></li>
                            <li><a href="./tags.html">Tags</a></li>
                            <li><a href="./authors.html">Authors</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="#" target="_blank">github</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="#" target="_blank">github</a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; blogname 2015</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>